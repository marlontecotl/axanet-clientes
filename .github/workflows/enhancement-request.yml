# ========================================================================
# WORKFLOW 4: SOLICITUD DE MEJORA A LA APLICACIÃ“N
# ========================================================================
#
# ğŸ“‹ PROPÃ“SITO: Gestionar solicitudes de mejora a funcionalidades existentes
# ğŸ¯ REQUISITOS PROYECTO II: workflow_dispatch + Issues con etiqueta "enhancement"

name: "ğŸ”§ Enhancement Request - Solicitud de Mejora"

on:
  # TRIGGER 1: EJECUCIÃ“N MANUAL (REQUERIDO)
  workflow_dispatch:
    inputs:
      enhancement_title:
        description: 'TÃ­tulo de la mejora solicitada'
        required: true
        default: 'Mejorar validaciÃ³n de datos de entrada'
        type: string
      enhancement_description:
        description: 'DescripciÃ³n detallada de la mejora'
        required: true
        default: 'Implementar validaciÃ³n mÃ¡s robusta para emails y telÃ©fonos'
        type: string

  # TRIGGER 2: ISSUES CON ETIQUETA (SUMA PUNTOS)
  issues:
    types: [opened, labeled]

jobs:
  process-enhancement-request:
    name: "ğŸ”§ Procesar Solicitud de Mejora"
    runs-on: ubuntu-latest
    
    if: |
      github.event_name == 'workflow_dispatch' || 
      (github.event_name == 'issues' && 
       contains(github.event.issue.labels.*.name, 'enhancement'))
    
    steps:
      - name: "ï¿½ï¿½ Identificar Fuente"
        id: source
        run: |
          if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            echo "Fuente: EjecuciÃ³n manual por ${{ github.actor }}"
            echo "source=manual" >> $GITHUB_OUTPUT
          else
            echo "Fuente: Issue #${{ github.event.issue.number }} por ${{ github.event.issue.user.login }}"
            echo "source=issue" >> $GITHUB_OUTPUT
          fi

      - name: "ï¿½ï¿½ Extraer Datos"
        id: data
        run: |
          if [ "${{ steps.source.outputs.source }}" = "manual" ]; then
            TITLE="${{ github.event.inputs.enhancement_title }}"
            DESCRIPTION="${{ github.event.inputs.enhancement_description }}"
          else
            TITLE="${{ github.event.issue.title }}"
            DESCRIPTION="${{ github.event.issue.body }}"
          fi
          
          echo "title=$TITLE" >> $GITHUB_OUTPUT
          echo "description=$DESCRIPTION" >> $GITHUB_OUTPUT

      # STEP PRINCIPAL: FORMATO EXACTO REQUERIDO POR PROYECTO II
      - name: "ï¿½ï¿½ NotificaciÃ³n Principal - Formato Proyecto II"
        run: |
          echo "[SOLICITUD DE MEJORA RECIBIDA]"
          echo "TÃ­tulo: '${{ steps.data.outputs.title }}'"
          echo "DescripciÃ³n: '${{ steps.data.outputs.description }}'"
          echo "Asignando a DevLead para revisiÃ³n."
          echo "Notificando a todos los equipos."

      - name: "ğŸ‘¥ NotificaciÃ³n Detallada"
        run: |
          echo ""
          echo "ğŸ”§ EQUIPOS NOTIFICADOS:"
          echo "   ğŸ“§ DevTeam: carlos-devlead-axanet, ana-dev-axanet"
          echo "   ğŸ“§ ITTeam: miguel-itops-axanet, sofia-sysadmin-axanet"  
          echo "   ğŸ“§ CustServTeam: roberto-cs-axanet, laura-support-axanet"
          echo ""
          echo "ğŸ“‹ Workflow ejecutado: $(date '+%Y-%m-%d %H:%M:%S UTC')"
          echo "ğŸ›ï¸ Repositorio: ${{ github.repository }}"
          echo "ğŸ”— Run ID: ${{ github.run_id }}"
